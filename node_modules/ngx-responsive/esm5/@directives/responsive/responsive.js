import * as tslib_1 from "tslib";
/**
 * @name responsive
 * @description Responsive directive in ngx-responsive
 *
 * @license MIT
 */
import { Output, EventEmitter, Directive, Input, TemplateRef, ViewContainerRef, ChangeDetectorRef } from '@angular/core';
import { PLATFORM_ID, Inject } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { ResponsiveState } from '../../@core/providers/responsive-state/responsive-state';
import { ResponsiveWindowDirective } from "../responsive-window/responsive-window";
var ResponsiveDirective = /** @class */ (function () {
    function ResponsiveDirective(templateRef, _responsiveState, viewContainer, cd, _platformId) {
        this.templateRef = templateRef;
        this._responsiveState = _responsiveState;
        this.viewContainer = viewContainer;
        this.cd = cd;
        this._platformId = _platformId;
        this.changes = new EventEmitter();
        this._windows = null;
        this._window = null;
        this._isBrowser = null;
        this.set_values = {
            bootstrap: '',
            browser: '',
            device: '',
            pixelratio: '',
            orientation: '',
            standard: '',
            ie: '',
            sizes: 0
        };
        this.set_active_subscriptions = {
            bootstrap: false,
            browser: false,
            device: false,
            pixelratio: false,
            orientation: false,
            standard: false,
            ie: false,
            sizes: false
        };
        this.match_multiple = {
            bootstrap: false,
            browser: false,
            device: false,
            pixelratio: false,
            orientation: false,
            standard: false,
            ie: false,
            sizes: false
        };
        this._showWhenTrue = true;
        this._globalNoRepeat = 0;
        this._bootstrapNoRepeat = 0;
        this._deviceNoRepeat = 0;
        this._standardNoRepeat = 0;
        this._orientationNoRepeat = 0;
        this._browserNoRepeat = 0;
        this._pixelratioNoRepeat = 0;
        this._ieNoRepeat = 0;
        this._sizesNoRepeat = 0;
        this._bootstrap_user_param = [];
        this._devices_user_param = [];
        this._standard_user_param = [];
        this._orientation_user_param = [];
        this._browser_user_param = [];
        this._pixelratio_user_param = [];
        this._ie_user_param = [];
        this._sizes_user_param = [0, Number.MAX_VALUE];
        this._sizes_window = 'window';
        // private _sizes_container = null;
        this._actives = [];
        this._isBrowser = isPlatformBrowser(this._platformId);
    }
    Object.defineProperty(ResponsiveDirective.prototype, "responsive", {
        set: function (config) {
            this._config = config;
            this.init_responsive();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ResponsiveDirective.prototype, "config", {
        get: function () {
            return this._config;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ResponsiveDirective.prototype, "responsiveContainer", {
        get: function () {
            return this._responsiveContainer;
        },
        set: function (value) {
            this._responsiveContainer = value;
            if (this.config) {
                if (this._sizes_window !== null && this._sizes_window !== "window") {
                    throw new Error('Responsive directive cannot use window AND responsiveContainer together');
                }
                this.init_responsive();
            }
        },
        enumerable: true,
        configurable: true
    });
    ResponsiveDirective.prototype.init_responsive = function () {
        var config = this.config;
        if (this.isJSON(config)) {
            if (!!config.bootstrap && this._bootstrapNoRepeat === 0) {
                this._bootstrap_user_param = (Array.isArray(config.bootstrap) ? config.bootstrap : [config.bootstrap]);
                this._bootstrapNoRepeat = 1;
                this.set_active_subscriptions.bootstrap = true;
            }
            if (!!config.device && this._deviceNoRepeat === 0) {
                this._devices_user_param = (Array.isArray(config.device) ? config.device : [config.device]);
                this._deviceNoRepeat = 1;
                this.set_active_subscriptions.device = true;
            }
            if (!!config.standard && this._standardNoRepeat === 0) {
                this._standard_user_param = (Array.isArray(config.standard) ? config.standard : [config.standard]);
                this._standardNoRepeat = 1;
                this.set_active_subscriptions.standard = true;
            }
            if (!!config.orientation && this._orientationNoRepeat === 0) {
                this._orientation_user_param = (Array.isArray(config.orientation) ? config.orientation : [config.orientation]);
                this._orientationNoRepeat = 1;
                this.set_active_subscriptions.orientation = true;
            }
            if (!!config.browser && this._browserNoRepeat === 0) {
                this._browser_user_param = (Array.isArray(config.browser) ? config.browser : [config.browser]);
                this._browserNoRepeat = 1;
                this.set_active_subscriptions.browser = true;
            }
            if (!!config.pixelratio && this._pixelratioNoRepeat === 0) {
                this._pixelratio_user_param = (Array.isArray(config.pixelratio) ? config.pixelratio : [config.pixelratio]);
                this._pixelratioNoRepeat = 1;
                this.set_active_subscriptions.pixelratio = true;
            }
            if (!!config.ie && this._ieNoRepeat === 0) {
                this._ie_user_param = (Array.isArray(config.ie) ? config.ie : [config.ie]);
                this._ieNoRepeat = 1;
                this.set_active_subscriptions.ie = true;
            }
            if (!!config.sizes && this._sizesNoRepeat === 0) {
                var _min = config.sizes.min || 0;
                var _max = config.sizes.max || Number.MAX_VALUE;
                var _win = config.sizes.window;
                if (_win !== undefined) {
                    this._sizes_window = _win;
                }
                // this._sizes_container = value.sizes.container;
                this._sizes_user_param = [_min, _max];
                this._sizesNoRepeat = 1;
                this.set_active_subscriptions.sizes = true;
            }
        }
        else if (Array.isArray(config)) {
            throw new Error('Responsive directive don´t work with a only array parameter');
        }
        else if (typeof config === 'string') {
            throw new Error('Responsive directive don´t work with a only string parameter');
        }
        else if (typeof config === 'number') {
            throw new Error('Responsive directive don´t work with a only number parameter');
        }
        else if (typeof config === 'undefined' || config === null) {
            throw new Error('Responsive directive don´t work without a param');
        }
        for (var key in this.set_active_subscriptions) {
            if (this.set_active_subscriptions[key]) {
                this._actives.push(key);
            }
        }
        if (this._isBrowser) {
            if (this.set_active_subscriptions.bootstrap) {
                this._subscription_Bootstrap = this._responsiveState.elemento$.subscribe(this.updateBootstrap.bind(this));
            }
            if (this.set_active_subscriptions.browser) {
                this._subscription_Browser = this._responsiveState.browser$.subscribe(this.updateBrowser.bind(this));
            }
            if (this.set_active_subscriptions.device) {
                this._subscription_Device = this._responsiveState.device$.subscribe(this.updateDevice.bind(this));
            }
            if (this.set_active_subscriptions.pixelratio) {
                this._subscription_Pixel_Ratio = this._responsiveState.pixel$.subscribe(this.updatePixelRatio.bind(this));
            }
            if (this.set_active_subscriptions.orientation) {
                this._subscription_Orientation = this._responsiveState.orientation$.subscribe(this.updateOrientation.bind(this));
            }
            if (this.set_active_subscriptions.standard) {
                this._subscription_Standard = this._responsiveState.standard$.subscribe(this.updateStandard.bind(this));
            }
            if (this.set_active_subscriptions.ie) {
                this._subscription_IE_Version = this._responsiveState.ieVersion$.subscribe(this.updateIEversion.bind(this));
            }
            if (this.set_active_subscriptions.sizes) {
                this._subscription_custom_sizes = this._responsiveState.ancho$.subscribe(this.updateSizes.bind(this));
            }
        }
    };
    ResponsiveDirective.prototype.updateBootstrap = function (value) {
        var _update = this._ifValueChanged(this._noRepeatBootstrapName, value);
        if (_update) {
            this.set_values.bootstrap = value;
        }
        this.updateEvent(this.set_values.bootstrap, 'bootstrap');
    };
    ResponsiveDirective.prototype.updateBrowser = function (value) {
        this.set_values.browser = value;
        this.updateEvent(this.set_values.browser, 'browser');
    };
    ResponsiveDirective.prototype.updateDevice = function (value) {
        this.set_values.device = value;
        this.updateEvent(this.set_values.device, 'device');
    };
    ResponsiveDirective.prototype.updatePixelRatio = function (value) {
        this.set_values.pixelratio = value;
        this.updateEvent(this.set_values.pixelratio, 'pixelratio');
    };
    ResponsiveDirective.prototype.updateOrientation = function (value) {
        this.set_values.orientation = value;
        this.updateEvent(this.set_values.orientation, 'orientation');
    };
    ResponsiveDirective.prototype.updateStandard = function (value) {
        this.set_values.standard = value;
        this.updateEvent(this.set_values.standard, 'standard');
    };
    ResponsiveDirective.prototype.updateIEversion = function (value) {
        this.set_values.ie = value;
        this.updateEvent(this.set_values.ie, 'ie');
    };
    ResponsiveDirective.prototype.updateSizes = function (value) {
        if (this.responsiveContainer) {
            this.set_values.sizes = this._isBrowser ? this.responsiveContainer.getWidth() : 0;
        }
        else if (this._sizes_window) {
            this.set_values.sizes = this._responsiveState.getWidth(this._sizes_window);
        }
        else {
            this.set_values.sizes = value;
        }
        this.updateEvent(this.set_values.sizes, 'sizes');
    };
    ResponsiveDirective.prototype.updateEvent = function (param, type_directive) {
        if (!!this._showWhenTrue) {
            switch (type_directive) {
                case 'bootstrap':
                    this.showHideOperations(this._bootstrap_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'device':
                    this.showHideOperations(this._devices_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'standard':
                    this.showHideOperations(this._standard_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'orientation':
                    this.showHideOperations(this._orientation_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'browser':
                    this.showHideOperations(this._browser_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'pixelratio':
                    this.showHideOperations(this._pixelratio_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'ie':
                    this.showHideOperations(this._ie_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'sizes':
                    this.showHideOperations((param >= this._sizes_user_param[0] &&
                        param < this._sizes_user_param[1]), type_directive);
                    break;
            }
        }
        else {
            switch (type_directive) {
                case 'bootstrap':
                    this.showHideOperations(!(this._bootstrap_user_param.indexOf(param)), type_directive);
                    break;
                case 'device':
                    this.showHideOperations(!(this._devices_user_param.indexOf(param)), type_directive);
                    break;
                case 'standard':
                    this.showHideOperations(!(this._standard_user_param.indexOf(param)), type_directive);
                    break;
                case 'orientation':
                    this.showHideOperations(!(this._orientation_user_param.indexOf(param)), type_directive);
                    break;
                case 'browser':
                    this.showHideOperations(!(this._browser_user_param.indexOf(param)), type_directive);
                    break;
                case 'pixelratio':
                    this.showHideOperations(!(this._pixelratio_user_param.indexOf(param)), type_directive);
                    break;
                case 'ie':
                    this.showHideOperations(!(this._ie_user_param.indexOf(param)), type_directive);
                    break;
                case 'sizes':
                    this.showHideOperations(!((param >= this._sizes_user_param[0] &&
                        param < this._sizes_user_param[1])), type_directive);
                    break;
            }
        }
    };
    ResponsiveDirective.prototype.showHideOperations = function (show, type_directive) {
        var global_state = this.matchValues(show, type_directive);
        if (!!global_state) {
            if (this._globalNoRepeat === 0) {
                this._globalNoRepeat = 1;
                this.viewContainer.createEmbeddedView(this.templateRef);
                this.changes.emit(true);
                this.cd.markForCheck();
            }
        }
        else {
            this._globalNoRepeat = 0;
            this.changes.emit(false);
            this.viewContainer.clear();
            this.cd.markForCheck();
        }
    };
    ResponsiveDirective.prototype.matchValues = function (show, type_directive) {
        var e_1, _a;
        var match = true;
        if (show) {
            this.match_multiple[type_directive] = true;
        }
        else {
            this.match_multiple[type_directive] = false;
        }
        for (var all_key in this.match_multiple) {
            try {
                for (var _b = (e_1 = void 0, tslib_1.__values(this._actives)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var active = _c.value;
                    if (all_key == active && this.match_multiple[all_key] === false)
                        return match = false;
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return match;
    };
    ResponsiveDirective.prototype.ngOnDestroy = function () {
        if (this._isBrowser) {
            if (this.set_active_subscriptions.bootstrap) {
                this._subscription_Bootstrap.unsubscribe();
            }
            if (this.set_active_subscriptions.browser) {
                this._subscription_Browser.unsubscribe();
            }
            if (this.set_active_subscriptions.device) {
                this._subscription_Device.unsubscribe();
            }
            if (this.set_active_subscriptions.pixelratio) {
                this._subscription_Pixel_Ratio.unsubscribe();
            }
            if (this.set_active_subscriptions.orientation) {
                this._subscription_Orientation.unsubscribe();
            }
            if (this.set_active_subscriptions.standard) {
                this._subscription_Standard.unsubscribe();
            }
            if (this.set_active_subscriptions.ie) {
                this._subscription_IE_Version.unsubscribe();
            }
            if (this.set_active_subscriptions.sizes) {
                this._subscription_custom_sizes.unsubscribe();
            }
        }
    };
    ResponsiveDirective.prototype._ifValueChanged = function (oldValue, newValue) {
        if (oldValue === newValue) {
            return false;
        }
        else {
            this._noRepeatBootstrapName = newValue;
            return true;
        }
    };
    ResponsiveDirective.prototype.isJSON = function (value) {
        try {
            JSON.stringify(value);
            return true;
        }
        catch (ex) {
            return false;
        }
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], ResponsiveDirective.prototype, "responsive", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", ResponsiveWindowDirective),
        tslib_1.__metadata("design:paramtypes", [ResponsiveWindowDirective])
    ], ResponsiveDirective.prototype, "responsiveContainer", null);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], ResponsiveDirective.prototype, "changes", void 0);
    ResponsiveDirective = tslib_1.__decorate([
        Directive({
            selector: '[responsive]'
        }),
        tslib_1.__param(4, Inject(PLATFORM_ID)),
        tslib_1.__metadata("design:paramtypes", [TemplateRef,
            ResponsiveState,
            ViewContainerRef,
            ChangeDetectorRef, Object])
    ], ResponsiveDirective);
    return ResponsiveDirective;
}());
export { ResponsiveDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzcG9uc2l2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1yZXNwb25zaXZlLyIsInNvdXJjZXMiOlsiQGRpcmVjdGl2ZXMvcmVzcG9uc2l2ZS9yZXNwb25zaXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRztBQUNILE9BQU8sRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLGdCQUFnQixFQUFhLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BJLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBSXBELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUMxRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQU1uRjtJQXFHSSw2QkFDVyxXQUFnQyxFQUMvQixnQkFBaUMsRUFDakMsYUFBK0IsRUFDL0IsRUFBcUIsRUFDRSxXQUFXO1FBSm5DLGdCQUFXLEdBQVgsV0FBVyxDQUFxQjtRQUMvQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWlCO1FBQ2pDLGtCQUFhLEdBQWIsYUFBYSxDQUFrQjtRQUMvQixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNFLGdCQUFXLEdBQVgsV0FBVyxDQUFBO1FBL0VwQyxZQUFPLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEQsYUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixZQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ2YsZUFBVSxHQUFZLElBQUksQ0FBQztRQUM1QixlQUFVLEdBQXVCO1lBQ3BDLFNBQVMsRUFBRSxFQUFFO1lBQ2IsT0FBTyxFQUFFLEVBQUU7WUFDWCxNQUFNLEVBQUUsRUFBRTtZQUNWLFVBQVUsRUFBRSxFQUFFO1lBQ2QsV0FBVyxFQUFFLEVBQUU7WUFDZixRQUFRLEVBQUUsRUFBRTtZQUNaLEVBQUUsRUFBRSxFQUFFO1lBQ04sS0FBSyxFQUFFLENBQUM7U0FDWCxDQUFDO1FBRU0sNkJBQXdCLEdBQzVCO1lBQ0ksU0FBUyxFQUFFLEtBQUs7WUFDaEIsT0FBTyxFQUFFLEtBQUs7WUFDZCxNQUFNLEVBQUUsS0FBSztZQUNiLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFFBQVEsRUFBRSxLQUFLO1lBQ2YsRUFBRSxFQUFFLEtBQUs7WUFDVCxLQUFLLEVBQUUsS0FBSztTQUNmLENBQUM7UUFDRSxtQkFBYyxHQUNsQjtZQUNJLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLE9BQU8sRUFBRSxLQUFLO1lBQ2QsTUFBTSxFQUFFLEtBQUs7WUFDYixVQUFVLEVBQUUsS0FBSztZQUNqQixXQUFXLEVBQUUsS0FBSztZQUNsQixRQUFRLEVBQUUsS0FBSztZQUNmLEVBQUUsRUFBRSxLQUFLO1lBQ1QsS0FBSyxFQUFFLEtBQUs7U0FDZixDQUFDO1FBWUksa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFDdkIsb0JBQWUsR0FBRyxDQUFDLENBQUM7UUFHcEIsdUJBQWtCLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLG9CQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLHNCQUFpQixHQUFHLENBQUMsQ0FBQztRQUN0Qix5QkFBb0IsR0FBRyxDQUFDLENBQUM7UUFDekIscUJBQWdCLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLHdCQUFtQixHQUFHLENBQUMsQ0FBQztRQUN4QixnQkFBVyxHQUFHLENBQUMsQ0FBQztRQUNoQixtQkFBYyxHQUFHLENBQUMsQ0FBQztRQUVuQiwwQkFBcUIsR0FBYSxFQUFFLENBQUM7UUFDckMsd0JBQW1CLEdBQWEsRUFBRSxDQUFDO1FBQ25DLHlCQUFvQixHQUFhLEVBQUUsQ0FBQztRQUNwQyw0QkFBdUIsR0FBYSxFQUFFLENBQUM7UUFDdkMsd0JBQW1CLEdBQWEsRUFBRSxDQUFDO1FBQ25DLDJCQUFzQixHQUFhLEVBQUUsQ0FBQztRQUN0QyxtQkFBYyxHQUFhLEVBQUUsQ0FBQztRQUM5QixzQkFBaUIsR0FBcUIsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzVELGtCQUFhLEdBQUcsUUFBUSxDQUFDO1FBQ2pDLG1DQUFtQztRQUV6QixhQUFRLEdBQWEsRUFBRSxDQUFDO1FBUzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUExR1Esc0JBQUksMkNBQVU7YUFBZCxVQUFlLE1BQXlCO1lBQzdDLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUMzQixDQUFDOzs7T0FBQTtJQUNELHNCQUFJLHVDQUFNO2FBQVY7WUFDSSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDeEIsQ0FBQzs7O09BQUE7SUFLRCxzQkFBSSxvREFBbUI7YUFTdkI7WUFDSSxPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztRQUNyQyxDQUFDO2FBWEQsVUFBd0IsS0FBZ0M7WUFDdEQsSUFBSSxDQUFDLG9CQUFvQixHQUFHLEtBQUssQ0FBQztZQUNsQyxJQUFHLElBQUksQ0FBQyxNQUFNLEVBQUM7Z0JBQ1gsSUFBRyxJQUFJLENBQUMsYUFBYSxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFFBQVEsRUFBRTtvQkFDakUsTUFBTSxJQUFJLEtBQUssQ0FBQyx5RUFBeUUsQ0FBQyxDQUFDO2lCQUM1RjtnQkFDRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7YUFDMUI7UUFDSCxDQUFDOzs7T0FBQTtJQXlGTSw2Q0FBZSxHQUF0QjtRQUNJLElBQU0sTUFBTSxHQUFRLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDaEMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLGtCQUFrQixLQUFLLENBQUMsRUFBRTtnQkFDckQsSUFBSSxDQUFDLHFCQUFxQixHQUFhLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pILElBQUksQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLENBQUM7Z0JBQzVCLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO2FBQ2xEO1lBQ0QsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLENBQUMsRUFBRTtnQkFDL0MsSUFBSSxDQUFDLG1CQUFtQixHQUFhLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ3RHLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsd0JBQXdCLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQzthQUMvQztZQUNELElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLGlCQUFpQixLQUFLLENBQUMsRUFBRTtnQkFDbkQsSUFBSSxDQUFDLG9CQUFvQixHQUFhLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQzdHLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLENBQUM7Z0JBQzNCLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO2FBQ2pEO1lBQ0QsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsb0JBQW9CLEtBQUssQ0FBQyxFQUFFO2dCQUN6RCxJQUFJLENBQUMsdUJBQXVCLEdBQWEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztnQkFDekgsSUFBSSxDQUFDLG9CQUFvQixHQUFHLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxDQUFDLHdCQUF3QixDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7YUFDcEQ7WUFDRCxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pELElBQUksQ0FBQyxtQkFBbUIsR0FBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUN6RyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDO2dCQUMxQixJQUFJLENBQUMsd0JBQXdCLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQzthQUNoRDtZQUNELElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLG1CQUFtQixLQUFLLENBQUMsRUFBRTtnQkFDdkQsSUFBSSxDQUFDLHNCQUFzQixHQUFhLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JILElBQUksQ0FBQyxtQkFBbUIsR0FBRyxDQUFDLENBQUM7Z0JBQzdCLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO2FBQ25EO1lBQ0QsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLENBQUMsRUFBRTtnQkFDdkMsSUFBSSxDQUFDLGNBQWMsR0FBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNyRixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztnQkFDckIsSUFBSSxDQUFDLHdCQUF3QixDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7YUFDM0M7WUFDRCxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxjQUFjLEtBQUssQ0FBQyxFQUFFO2dCQUM3QyxJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQ25DLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUM7Z0JBQ2xELElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO2dCQUNqQyxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7b0JBQ3BCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO2lCQUM3QjtnQkFDRCxpREFBaUQ7Z0JBQ2pELElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLENBQUM7Z0JBQ3hCLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO2FBQzlDO1NBQ0o7YUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO1NBQ2xGO2FBQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7WUFDbkMsTUFBTSxJQUFJLEtBQUssQ0FBQyw4REFBOEQsQ0FBQyxDQUFDO1NBQ25GO2FBQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7WUFDbkMsTUFBTSxJQUFJLEtBQUssQ0FBQyw4REFBOEQsQ0FBQyxDQUFDO1NBQ25GO2FBQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxLQUFLLElBQUksRUFBRTtZQUN6RCxNQUFNLElBQUksS0FBSyxDQUFDLGlEQUFpRCxDQUFDLENBQUM7U0FDdEU7UUFFRCxLQUFLLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUMzQyxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDcEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDM0I7U0FDSjtRQUNELElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNqQixJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxTQUFTLEVBQUU7Z0JBQ3pDLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2FBQzdHO1lBQ0QsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsT0FBTyxFQUFFO2dCQUN2QyxJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUN4RztZQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRTtnQkFDdEMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDckc7WUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxVQUFVLEVBQUU7Z0JBQzFDLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDN0c7WUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxXQUFXLEVBQUU7Z0JBQzNDLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDcEg7WUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2FBQzNHO1lBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsRUFBRSxFQUFFO2dCQUNsQyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUMvRztZQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixDQUFDLEtBQUssRUFBRTtnQkFDckMsSUFBSSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDekc7U0FDSjtJQUNMLENBQUM7SUFFTyw2Q0FBZSxHQUF2QixVQUF3QixLQUFhO1FBQ2pDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3pFLElBQUksT0FBTyxFQUFFO1lBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1NBQ3JDO1FBQ0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBQ08sMkNBQWEsR0FBckIsVUFBc0IsS0FBYTtRQUMvQixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ08sMENBQVksR0FBcEIsVUFBcUIsS0FBYTtRQUM5QixJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDL0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBQ08sOENBQWdCLEdBQXhCLFVBQXlCLEtBQWE7UUFDbEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUNPLCtDQUFpQixHQUF6QixVQUEwQixLQUFhO1FBQ25DLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUNwQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFDTyw0Q0FBYyxHQUF0QixVQUF1QixLQUFhO1FBQ2hDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFDTyw2Q0FBZSxHQUF2QixVQUF3QixLQUFhO1FBQ2pDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUMzQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFDTyx5Q0FBVyxHQUFuQixVQUFvQixLQUFhO1FBQzdCLElBQUcsSUFBSSxDQUFDLG1CQUFtQixFQUFDO1lBQ3hCLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3JGO2FBQUssSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFDO1lBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQzlFO2FBQUk7WUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7U0FDakM7UUFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFTyx5Q0FBVyxHQUFuQixVQUFvQixLQUFVLEVBQUUsY0FBc0I7UUFDbEQsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QixRQUFRLGNBQWMsRUFBRTtnQkFDcEIsS0FBSyxXQUFXO29CQUNaLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDO29CQUMxRixNQUFNO2dCQUNWLEtBQUssUUFBUTtvQkFDVCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztvQkFDeEYsTUFBTTtnQkFDVixLQUFLLFVBQVU7b0JBQ1gsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUM7b0JBQ3pGLE1BQU07Z0JBQ1YsS0FBSyxhQUFhO29CQUNkLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDO29CQUM1RixNQUFNO2dCQUNWLEtBQUssU0FBUztvQkFDVixJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztvQkFDeEYsTUFBTTtnQkFDVixLQUFLLFlBQVk7b0JBQ2IsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUM7b0JBQzNGLE1BQU07Z0JBQ1YsS0FBSyxJQUFJO29CQUNMLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztvQkFDbkYsTUFBTTtnQkFDVixLQUFLLE9BQU87b0JBQ1IsSUFBSSxDQUFDLGtCQUFrQixDQUNuQixDQUNJLEtBQUssSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO3dCQUNsQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUNwQyxFQUNELGNBQWMsQ0FBQyxDQUFDO29CQUNwQixNQUFNO2FBQ2I7U0FDSjthQUFNO1lBRUgsUUFBUSxjQUFjLEVBQUU7Z0JBQ3BCLEtBQUssV0FBVztvQkFDWixJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztvQkFDdEYsTUFBTTtnQkFDVixLQUFLLFFBQVE7b0JBQ1QsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUM7b0JBQ3BGLE1BQU07Z0JBQ1YsS0FBSyxVQUFVO29CQUNYLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDO29CQUNyRixNQUFNO2dCQUNWLEtBQUssYUFBYTtvQkFDZCxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztvQkFDeEYsTUFBTTtnQkFDVixLQUFLLFNBQVM7b0JBQ1YsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUM7b0JBQ3BGLE1BQU07Z0JBQ1YsS0FBSyxZQUFZO29CQUNiLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDO29CQUN2RixNQUFNO2dCQUNWLEtBQUssSUFBSTtvQkFDTCxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUM7b0JBQy9FLE1BQU07Z0JBQ1YsS0FBSyxPQUFPO29CQUNSLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FDdEIsS0FBSyxJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7d0JBQ2xDLEtBQUssR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUNuQyxjQUFjLENBQUMsQ0FBQztvQkFDcEIsTUFBTTthQUNiO1NBQ0o7SUFDTCxDQUFDO0lBRU8sZ0RBQWtCLEdBQTFCLFVBQTJCLElBQWEsRUFBRSxjQUFzQjtRQUM1RCxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUU7WUFDaEIsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLENBQUMsRUFBRTtnQkFDNUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUN4RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQzthQUMxQjtTQUNKO2FBQU07WUFDSCxJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDMUI7SUFDTCxDQUFDO0lBRU8seUNBQVcsR0FBbkIsVUFBb0IsSUFBYSxFQUFFLGNBQXNCOztRQUNyRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxJQUFJLEVBQUU7WUFDTixJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxHQUFHLElBQUksQ0FBQztTQUM5QzthQUFNO1lBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsR0FBRyxLQUFLLENBQUM7U0FDL0M7UUFFRCxLQUFLLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7O2dCQUNyQyxLQUFtQixJQUFBLG9CQUFBLGlCQUFBLElBQUksQ0FBQyxRQUFRLENBQUEsQ0FBQSxnQkFBQSw0QkFBRTtvQkFBN0IsSUFBSSxNQUFNLFdBQUE7b0JBQ1gsSUFBSSxPQUFPLElBQUksTUFBTSxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssS0FBSzt3QkFDM0QsT0FBTyxLQUFLLEdBQUcsS0FBSyxDQUFDO2lCQUM1Qjs7Ozs7Ozs7O1NBQ0o7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRU0seUNBQVcsR0FBbEI7UUFDSSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDakIsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsU0FBUyxFQUFFO2dCQUN6QyxJQUFJLENBQUMsdUJBQXVCLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDOUM7WUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxPQUFPLEVBQUU7Z0JBQ3ZDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUM1QztZQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRTtnQkFDdEMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQzNDO1lBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsVUFBVSxFQUFFO2dCQUMxQyxJQUFJLENBQUMseUJBQXlCLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDaEQ7WUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxXQUFXLEVBQUU7Z0JBQzNDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUNoRDtZQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixDQUFDLFFBQVEsRUFBRTtnQkFDeEMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQzdDO1lBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsRUFBRSxFQUFFO2dCQUNsQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDL0M7WUFFRCxJQUFJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3JDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUNqRDtTQUNKO0lBQ0wsQ0FBQztJQUVPLDZDQUFlLEdBQXZCLFVBQXdCLFFBQWEsRUFBRSxRQUFhO1FBQ2hELElBQUksUUFBUSxLQUFLLFFBQVEsRUFBRTtZQUN2QixPQUFPLEtBQUssQ0FBQztTQUNoQjthQUFNO1lBQ0gsSUFBSSxDQUFDLHNCQUFzQixHQUFHLFFBQVEsQ0FBQztZQUN2QyxPQUFPLElBQUksQ0FBQztTQUNmO0lBQ0wsQ0FBQztJQUVPLG9DQUFNLEdBQWQsVUFBZSxLQUFVO1FBQ3JCLElBQUk7WUFDQSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFBQyxPQUFPLEVBQUUsRUFBRTtZQUNULE9BQU8sS0FBSyxDQUFDO1NBQ2hCO0lBQ0wsQ0FBQztJQWxaUTtRQUFSLEtBQUssRUFBRTs7O3lEQUdQO0lBUUQ7UUFEQyxLQUFLLEVBQUU7MENBQ3VCLHlCQUF5QjtpREFBekIseUJBQXlCO2tFQVF2RDtJQUtTO1FBQVQsTUFBTSxFQUFFOzBDQUFVLFlBQVk7d0RBQTJCO0lBM0JqRCxtQkFBbUI7UUFKL0IsU0FBUyxDQUNOO1lBQ0ksUUFBUSxFQUFFLGNBQWM7U0FDM0IsQ0FBQztRQTJHRyxtQkFBQSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7aURBSkEsV0FBVztZQUNMLGVBQWU7WUFDbEIsZ0JBQWdCO1lBQzNCLGlCQUFpQjtPQXpHeEIsbUJBQW1CLENBc1ovQjtJQUFELDBCQUFDO0NBQUEsQUF0WkQsSUFzWkM7U0F0WlksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBuYW1lIHJlc3BvbnNpdmVcclxuICogQGRlc2NyaXB0aW9uIFJlc3BvbnNpdmUgZGlyZWN0aXZlIGluIG5neC1yZXNwb25zaXZlXHJcbiAqXHJcbiAqIEBsaWNlbnNlIE1JVFxyXG4gKi9cclxuaW1wb3J0IHsgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIERpcmVjdGl2ZSwgSW5wdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q29udGFpbmVyUmVmLCBPbkRlc3Ryb3ksIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFBMQVRGT1JNX0lELCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IElSZXNwb25zaXZlUGF0dGVybiwgSVJlc3BvbnNpdmVTdWJzY3JpcHRpb25zIH0gZnJvbSAnLi4vLi4vQGNvcmUnO1xyXG5pbXBvcnQgeyBSZXNwb25zaXZlU3RhdGUgfSBmcm9tICcuLi8uLi9AY29yZS9wcm92aWRlcnMvcmVzcG9uc2l2ZS1zdGF0ZS9yZXNwb25zaXZlLXN0YXRlJztcclxuaW1wb3J0IHsgUmVzcG9uc2l2ZVdpbmRvd0RpcmVjdGl2ZSB9IGZyb20gXCIuLi9yZXNwb25zaXZlLXdpbmRvdy9yZXNwb25zaXZlLXdpbmRvd1wiO1xyXG5cclxuQERpcmVjdGl2ZShcclxuICAgIHtcclxuICAgICAgICBzZWxlY3RvcjogJ1tyZXNwb25zaXZlXSdcclxuICAgIH0pXHJcbmV4cG9ydCBjbGFzcyBSZXNwb25zaXZlRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuXHJcbiAgICBwcml2YXRlIF9jb25maWc6IHN0cmluZyB8IHN0cmluZ1tdO1xyXG4gICAgQElucHV0KCkgc2V0IHJlc3BvbnNpdmUoY29uZmlnOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICB0aGlzLmluaXRfcmVzcG9uc2l2ZSgpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNvbmZpZygpOiBzdHJpbmcgfCBzdHJpbmdbXXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBASW5wdXQoKSByZXNwb25zaXZlQ29udGFpbmVyOiBSZXNwb25zaXZlV2luZG93RGlyZWN0aXZlO1xyXG4gICAgcHJpdmF0ZSBfcmVzcG9uc2l2ZUNvbnRhaW5lcjpSZXNwb25zaXZlV2luZG93RGlyZWN0aXZlO1xyXG4gICAgQElucHV0KCkgXHJcbiAgICBzZXQgcmVzcG9uc2l2ZUNvbnRhaW5lcih2YWx1ZTogUmVzcG9uc2l2ZVdpbmRvd0RpcmVjdGl2ZSkge1xyXG4gICAgICB0aGlzLl9yZXNwb25zaXZlQ29udGFpbmVyID0gdmFsdWU7XHJcbiAgICAgIGlmKHRoaXMuY29uZmlnKXtcclxuICAgICAgICAgIGlmKHRoaXMuX3NpemVzX3dpbmRvdyAhPT0gbnVsbCAmJiB0aGlzLl9zaXplc193aW5kb3cgIT09IFwid2luZG93XCIpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXNwb25zaXZlIGRpcmVjdGl2ZSBjYW5ub3QgdXNlIHdpbmRvdyBBTkQgcmVzcG9uc2l2ZUNvbnRhaW5lciB0b2dldGhlcicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5pbml0X3Jlc3BvbnNpdmUoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHJlc3BvbnNpdmVDb250YWluZXIoKTogUmVzcG9uc2l2ZVdpbmRvd0RpcmVjdGl2ZXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVzcG9uc2l2ZUNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBAT3V0cHV0KCkgY2hhbmdlczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwcml2YXRlIF93aW5kb3dzID0gbnVsbDtcclxuICAgIHByaXZhdGUgX3dpbmRvdyA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9pc0Jyb3dzZXI6IGJvb2xlYW4gPSBudWxsO1xyXG4gICAgcHVibGljIHNldF92YWx1ZXM6IElSZXNwb25zaXZlUGF0dGVybiA9IHtcclxuICAgICAgICBib290c3RyYXA6ICcnLFxyXG4gICAgICAgIGJyb3dzZXI6ICcnLFxyXG4gICAgICAgIGRldmljZTogJycsXHJcbiAgICAgICAgcGl4ZWxyYXRpbzogJycsXHJcbiAgICAgICAgb3JpZW50YXRpb246ICcnLFxyXG4gICAgICAgIHN0YW5kYXJkOiAnJyxcclxuICAgICAgICBpZTogJycsXHJcbiAgICAgICAgc2l6ZXM6IDBcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnM6IElSZXNwb25zaXZlU3Vic2NyaXB0aW9ucyA9XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBib290c3RyYXA6IGZhbHNlLFxyXG4gICAgICAgICAgICBicm93c2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgZGV2aWNlOiBmYWxzZSxcclxuICAgICAgICAgICAgcGl4ZWxyYXRpbzogZmFsc2UsXHJcbiAgICAgICAgICAgIG9yaWVudGF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RhbmRhcmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBpZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHNpemVzOiBmYWxzZVxyXG4gICAgICAgIH07XHJcbiAgICBwcml2YXRlIG1hdGNoX211bHRpcGxlOiBJUmVzcG9uc2l2ZVN1YnNjcmlwdGlvbnMgPVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYm9vdHN0cmFwOiBmYWxzZSxcclxuICAgICAgICAgICAgYnJvd3NlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIGRldmljZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHBpeGVscmF0aW86IGZhbHNlLFxyXG4gICAgICAgICAgICBvcmllbnRhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0YW5kYXJkOiBmYWxzZSxcclxuICAgICAgICAgICAgaWU6IGZhbHNlLFxyXG4gICAgICAgICAgICBzaXplczogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbl9Cb290c3RyYXA6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbl9Ccm93c2VyOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIF9zdWJzY3JpcHRpb25fUGl4ZWxfUmF0aW86IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbl9EZXZpY2U6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbl9PcmllbnRhdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uX1N0YW5kYXJkOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIF9zdWJzY3JpcHRpb25fSUVfVmVyc2lvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uX2N1c3RvbV9zaXplczogU3Vic2NyaXB0aW9uO1xyXG5cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3Nob3dXaGVuVHJ1ZSA9IHRydWU7XHJcbiAgICBwcml2YXRlIF9nbG9iYWxOb1JlcGVhdCA9IDA7XHJcbiAgICBwcml2YXRlIF9ub1JlcGVhdEJvb3RzdHJhcE5hbWU6IHN0cmluZztcclxuXHJcbiAgICBwcml2YXRlIF9ib290c3RyYXBOb1JlcGVhdCA9IDA7XHJcbiAgICBwcml2YXRlIF9kZXZpY2VOb1JlcGVhdCA9IDA7XHJcbiAgICBwcml2YXRlIF9zdGFuZGFyZE5vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX29yaWVudGF0aW9uTm9SZXBlYXQgPSAwO1xyXG4gICAgcHJpdmF0ZSBfYnJvd3Nlck5vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX3BpeGVscmF0aW9Ob1JlcGVhdCA9IDA7XHJcbiAgICBwcml2YXRlIF9pZU5vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX3NpemVzTm9SZXBlYXQgPSAwO1xyXG5cclxuICAgIHByaXZhdGUgX2Jvb3RzdHJhcF91c2VyX3BhcmFtOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfZGV2aWNlc191c2VyX3BhcmFtOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfc3RhbmRhcmRfdXNlcl9wYXJhbTogc3RyaW5nW10gPSBbXTtcclxuICAgIHByaXZhdGUgX29yaWVudGF0aW9uX3VzZXJfcGFyYW06IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9icm93c2VyX3VzZXJfcGFyYW06IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9waXhlbHJhdGlvX3VzZXJfcGFyYW06IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9pZV91c2VyX3BhcmFtOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfc2l6ZXNfdXNlcl9wYXJhbTogW251bWJlciwgbnVtYmVyXSA9IFswLCBOdW1iZXIuTUFYX1ZBTFVFXTtcclxuICAgIHByaXZhdGUgX3NpemVzX3dpbmRvdyA9ICd3aW5kb3cnO1xyXG4gICAgLy8gcHJpdmF0ZSBfc2l6ZXNfY29udGFpbmVyID0gbnVsbDtcclxuXHJcbiAgICBwcm90ZWN0ZWQgX2FjdGl2ZXM6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxPYmplY3Q+LFxyXG4gICAgICAgIHByaXZhdGUgX3Jlc3BvbnNpdmVTdGF0ZTogUmVzcG9uc2l2ZVN0YXRlLFxyXG4gICAgICAgIHByaXZhdGUgdmlld0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZixcclxuICAgICAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcm90ZWN0ZWQgX3BsYXRmb3JtSWRcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuX2lzQnJvd3NlciA9IGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMuX3BsYXRmb3JtSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpbml0X3Jlc3BvbnNpdmUoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnOiBhbnkgPSB0aGlzLmNvbmZpZztcclxuICAgICAgICBpZiAodGhpcy5pc0pTT04oY29uZmlnKSkge1xyXG4gICAgICAgICAgICBpZiAoISFjb25maWcuYm9vdHN0cmFwICYmIHRoaXMuX2Jvb3RzdHJhcE5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ib290c3RyYXBfdXNlcl9wYXJhbSA9IDxzdHJpbmdbXT4oQXJyYXkuaXNBcnJheShjb25maWcuYm9vdHN0cmFwKSA/IGNvbmZpZy5ib290c3RyYXAgOiBbY29uZmlnLmJvb3RzdHJhcF0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYm9vdHN0cmFwTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuYm9vdHN0cmFwID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoISFjb25maWcuZGV2aWNlICYmIHRoaXMuX2RldmljZU5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kZXZpY2VzX3VzZXJfcGFyYW0gPSA8c3RyaW5nW10+KEFycmF5LmlzQXJyYXkoY29uZmlnLmRldmljZSkgPyBjb25maWcuZGV2aWNlIDogW2NvbmZpZy5kZXZpY2VdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZU5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmRldmljZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEhY29uZmlnLnN0YW5kYXJkICYmIHRoaXMuX3N0YW5kYXJkTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YW5kYXJkX3VzZXJfcGFyYW0gPSA8c3RyaW5nW10+KEFycmF5LmlzQXJyYXkoY29uZmlnLnN0YW5kYXJkKSA/IGNvbmZpZy5zdGFuZGFyZCA6IFtjb25maWcuc3RhbmRhcmRdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YW5kYXJkTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuc3RhbmRhcmQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghIWNvbmZpZy5vcmllbnRhdGlvbiAmJiB0aGlzLl9vcmllbnRhdGlvbk5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRhdGlvbl91c2VyX3BhcmFtID0gPHN0cmluZ1tdPihBcnJheS5pc0FycmF5KGNvbmZpZy5vcmllbnRhdGlvbikgPyBjb25maWcub3JpZW50YXRpb24gOiBbY29uZmlnLm9yaWVudGF0aW9uXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRhdGlvbk5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLm9yaWVudGF0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoISFjb25maWcuYnJvd3NlciAmJiB0aGlzLl9icm93c2VyTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Jyb3dzZXJfdXNlcl9wYXJhbSA9IDxzdHJpbmdbXT4oQXJyYXkuaXNBcnJheShjb25maWcuYnJvd3NlcikgPyBjb25maWcuYnJvd3NlciA6IFtjb25maWcuYnJvd3Nlcl0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYnJvd3Nlck5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmJyb3dzZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghIWNvbmZpZy5waXhlbHJhdGlvICYmIHRoaXMuX3BpeGVscmF0aW9Ob1JlcGVhdCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcGl4ZWxyYXRpb191c2VyX3BhcmFtID0gPHN0cmluZ1tdPihBcnJheS5pc0FycmF5KGNvbmZpZy5waXhlbHJhdGlvKSA/IGNvbmZpZy5waXhlbHJhdGlvIDogW2NvbmZpZy5waXhlbHJhdGlvXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9waXhlbHJhdGlvTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMucGl4ZWxyYXRpbyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEhY29uZmlnLmllICYmIHRoaXMuX2llTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2llX3VzZXJfcGFyYW0gPSA8c3RyaW5nW10+KEFycmF5LmlzQXJyYXkoY29uZmlnLmllKSA/IGNvbmZpZy5pZSA6IFtjb25maWcuaWVdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2llTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuaWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghIWNvbmZpZy5zaXplcyAmJiB0aGlzLl9zaXplc05vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfbWluID0gY29uZmlnLnNpemVzLm1pbiB8fCAwO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX21heCA9IGNvbmZpZy5zaXplcy5tYXggfHwgTnVtYmVyLk1BWF9WQUxVRTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF93aW4gPSBjb25maWcuc2l6ZXMud2luZG93O1xyXG4gICAgICAgICAgICAgICAgaWYgKF93aW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NpemVzX3dpbmRvdyA9IF93aW47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLl9zaXplc19jb250YWluZXIgPSB2YWx1ZS5zaXplcy5jb250YWluZXI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zaXplc191c2VyX3BhcmFtID0gW19taW4sIF9tYXhdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2l6ZXNOb1JlcGVhdCA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5zaXplcyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNpdmUgZGlyZWN0aXZlIGRvbsK0dCB3b3JrIHdpdGggYSBvbmx5IGFycmF5IHBhcmFtZXRlcicpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXNwb25zaXZlIGRpcmVjdGl2ZSBkb27CtHQgd29yayB3aXRoIGEgb25seSBzdHJpbmcgcGFyYW1ldGVyJyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNpdmUgZGlyZWN0aXZlIGRvbsK0dCB3b3JrIHdpdGggYSBvbmx5IG51bWJlciBwYXJhbWV0ZXInKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnIHx8IGNvbmZpZyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNpdmUgZGlyZWN0aXZlIGRvbsK0dCB3b3JrIHdpdGhvdXQgYSBwYXJhbScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9uc1trZXldKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVzLnB1c2goa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5faXNCcm93c2VyKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5ib290c3RyYXApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbl9Cb290c3RyYXAgPSB0aGlzLl9yZXNwb25zaXZlU3RhdGUuZWxlbWVudG8kLnN1YnNjcmliZSh0aGlzLnVwZGF0ZUJvb3RzdHJhcC5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuYnJvd3Nlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0Jyb3dzZXIgPSB0aGlzLl9yZXNwb25zaXZlU3RhdGUuYnJvd3NlciQuc3Vic2NyaWJlKHRoaXMudXBkYXRlQnJvd3Nlci5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmRldmljZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0RldmljZSA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5kZXZpY2UkLnN1YnNjcmliZSh0aGlzLnVwZGF0ZURldmljZS5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLnBpeGVscmF0aW8pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbl9QaXhlbF9SYXRpbyA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5waXhlbCQuc3Vic2NyaWJlKHRoaXMudXBkYXRlUGl4ZWxSYXRpby5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLm9yaWVudGF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fT3JpZW50YXRpb24gPSB0aGlzLl9yZXNwb25zaXZlU3RhdGUub3JpZW50YXRpb24kLnN1YnNjcmliZSh0aGlzLnVwZGF0ZU9yaWVudGF0aW9uLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuc3RhbmRhcmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbl9TdGFuZGFyZCA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5zdGFuZGFyZCQuc3Vic2NyaWJlKHRoaXMudXBkYXRlU3RhbmRhcmQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5pZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0lFX1ZlcnNpb24gPSB0aGlzLl9yZXNwb25zaXZlU3RhdGUuaWVWZXJzaW9uJC5zdWJzY3JpYmUodGhpcy51cGRhdGVJRXZlcnNpb24uYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5zaXplcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX2N1c3RvbV9zaXplcyA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5hbmNobyQuc3Vic2NyaWJlKHRoaXMudXBkYXRlU2l6ZXMuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVCb290c3RyYXAodmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IF91cGRhdGUgPSB0aGlzLl9pZlZhbHVlQ2hhbmdlZCh0aGlzLl9ub1JlcGVhdEJvb3RzdHJhcE5hbWUsIHZhbHVlKTtcclxuICAgICAgICBpZiAoX3VwZGF0ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldF92YWx1ZXMuYm9vdHN0cmFwID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLmJvb3RzdHJhcCwgJ2Jvb3RzdHJhcCcpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSB1cGRhdGVCcm93c2VyKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldF92YWx1ZXMuYnJvd3NlciA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLmJyb3dzZXIsICdicm93c2VyJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZURldmljZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZXRfdmFsdWVzLmRldmljZSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLmRldmljZSwgJ2RldmljZScpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSB1cGRhdGVQaXhlbFJhdGlvKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldF92YWx1ZXMucGl4ZWxyYXRpbyA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLnBpeGVscmF0aW8sICdwaXhlbHJhdGlvJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZU9yaWVudGF0aW9uKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldF92YWx1ZXMub3JpZW50YXRpb24gPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50KHRoaXMuc2V0X3ZhbHVlcy5vcmllbnRhdGlvbiwgJ29yaWVudGF0aW9uJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZVN0YW5kYXJkKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldF92YWx1ZXMuc3RhbmRhcmQgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50KHRoaXMuc2V0X3ZhbHVlcy5zdGFuZGFyZCwgJ3N0YW5kYXJkJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZUlFdmVyc2lvbih2YWx1ZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZXRfdmFsdWVzLmllID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFdmVudCh0aGlzLnNldF92YWx1ZXMuaWUsICdpZScpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSB1cGRhdGVTaXplcyh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgaWYodGhpcy5yZXNwb25zaXZlQ29udGFpbmVyKXtcclxuICAgICAgICAgICAgdGhpcy5zZXRfdmFsdWVzLnNpemVzID0gdGhpcy5faXNCcm93c2VyID8gdGhpcy5yZXNwb25zaXZlQ29udGFpbmVyLmdldFdpZHRoKCkgOiAwO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLl9zaXplc193aW5kb3cpe1xyXG4gICAgICAgICAgICB0aGlzLnNldF92YWx1ZXMuc2l6ZXMgPSB0aGlzLl9yZXNwb25zaXZlU3RhdGUuZ2V0V2lkdGgodGhpcy5fc2l6ZXNfd2luZG93KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5zZXRfdmFsdWVzLnNpemVzID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLnNpemVzLCAnc2l6ZXMnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUV2ZW50KHBhcmFtOiBhbnksIHR5cGVfZGlyZWN0aXZlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBpZiAoISF0aGlzLl9zaG93V2hlblRydWUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlX2RpcmVjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vdHN0cmFwJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyh0aGlzLl9ib290c3RyYXBfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSAhPT0gLTEsIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2RldmljZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnModGhpcy5fZGV2aWNlc191c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pICE9PSAtMSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc3RhbmRhcmQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKHRoaXMuX3N0YW5kYXJkX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkgIT09IC0xLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdvcmllbnRhdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnModGhpcy5fb3JpZW50YXRpb25fdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSAhPT0gLTEsIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jyb3dzZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKHRoaXMuX2Jyb3dzZXJfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSAhPT0gLTEsIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3BpeGVscmF0aW8nOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKHRoaXMuX3BpeGVscmF0aW9fdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSAhPT0gLTEsIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2llJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyh0aGlzLl9pZV91c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pICE9PSAtMSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2l6ZXMnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA+PSB0aGlzLl9zaXplc191c2VyX3BhcmFtWzBdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA8IHRoaXMuX3NpemVzX3VzZXJfcGFyYW1bMV1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZV9kaXJlY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb3RzdHJhcCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnMoISh0aGlzLl9ib290c3RyYXBfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSksIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2RldmljZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnMoISh0aGlzLl9kZXZpY2VzX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkpLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzdGFuZGFyZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnMoISh0aGlzLl9zdGFuZGFyZF91c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pKSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnb3JpZW50YXRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5fb3JpZW50YXRpb25fdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSksIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jyb3dzZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5fYnJvd3Nlcl91c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pKSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncGl4ZWxyYXRpbyc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnMoISh0aGlzLl9waXhlbHJhdGlvX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkpLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdpZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnMoISh0aGlzLl9pZV91c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pKSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2l6ZXMnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEoKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA+PSB0aGlzLl9zaXplc191c2VyX3BhcmFtWzBdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtIDwgdGhpcy5fc2l6ZXNfdXNlcl9wYXJhbVsxXSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93SGlkZU9wZXJhdGlvbnMoc2hvdzogYm9vbGVhbiwgdHlwZV9kaXJlY3RpdmU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGdsb2JhbF9zdGF0ZSA9IHRoaXMubWF0Y2hWYWx1ZXMoc2hvdywgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgIGlmICghIWdsb2JhbF9zdGF0ZSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fZ2xvYmFsTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2dsb2JhbE5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld0NvbnRhaW5lci5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50ZW1wbGF0ZVJlZik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZXMuZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9nbG9iYWxOb1JlcGVhdCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlcy5lbWl0KGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3Q29udGFpbmVyLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbWF0Y2hWYWx1ZXMoc2hvdzogYm9vbGVhbiwgdHlwZV9kaXJlY3RpdmU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBtYXRjaCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHNob3cpIHtcclxuICAgICAgICAgICAgdGhpcy5tYXRjaF9tdWx0aXBsZVt0eXBlX2RpcmVjdGl2ZV0gPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWF0Y2hfbXVsdGlwbGVbdHlwZV9kaXJlY3RpdmVdID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBhbGxfa2V5IGluIHRoaXMubWF0Y2hfbXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgYWN0aXZlIG9mIHRoaXMuX2FjdGl2ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhbGxfa2V5ID09IGFjdGl2ZSAmJiB0aGlzLm1hdGNoX211bHRpcGxlW2FsbF9rZXldID09PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2ggPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLl9pc0Jyb3dzZXIpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmJvb3RzdHJhcCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0Jvb3RzdHJhcC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuYnJvd3Nlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0Jyb3dzZXIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmRldmljZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0RldmljZS51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMucGl4ZWxyYXRpbykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX1BpeGVsX1JhdGlvLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5vcmllbnRhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX09yaWVudGF0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5zdGFuZGFyZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX1N0YW5kYXJkLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5pZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0lFX1ZlcnNpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLnNpemVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fY3VzdG9tX3NpemVzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaWZWYWx1ZUNoYW5nZWQob2xkVmFsdWU6IGFueSwgbmV3VmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmIChvbGRWYWx1ZSA9PT0gbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX25vUmVwZWF0Qm9vdHN0cmFwTmFtZSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0pTT04odmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=